# Shell agent with sandboxed shell access
flow shell(command: String) -> String:
    "Execute a sandboxed shell command. Output is limited to 50 lines."
    allowed = ["ls", "cat", "grep", "date", "echo", "wc", "pwd", "whoami", "head", "tail"]
    cmd = command.split(" ")[0]
    if not allowed.contains(cmd):
        return f"Error: '{cmd}' is not allowed"
    return __exec_shell__(command + " | head -50")

flow main():
    history = []
    system = "You are a helpful assistant with shell access. Use the shell tool to answer questions. After getting a tool result, give a brief answer. Be concise."
    write(stdout, "Shell agent ready. Type 'quit' to exit.")
    loop:
        input = read()
        if input == "quit":
            break
        history = history + [f"User: {input}"]
        context = history.join("\n")
        response = think(context, model="qwen2.5:7b", tools=["shell"], system=system)
        if response.has_tool_calls:
            response = exec(response, tools=["shell"])
            answer = think(context + "\n" + response.content, model="qwen2.5:7b", system=system)
            history = history + [f"Assistant: {answer}"]
            write(stdout, answer)
        else:
            history = history + [f"Assistant: {response.content}"]
            write(stdout, response.content)
