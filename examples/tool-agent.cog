# Agent with tools — flows are tools

# Shell with sandbox rules — only allowed commands
flow shell(command: String) -> String:
    "Execute a sandboxed shell command"
    allowed = ["ls", "date", "cat", "grep", "echo", "wc"]
    cmd = command.split(" ")[0]
    if not allowed.contains(cmd):
        return f"Error: '{cmd}' is not allowed"
    return __exec_shell__(command)

flow get_weather(city: String) -> String:
    "Get the current weather for a city"
    return f"Weather in {city}: 22°C, sunny"

flow get_time() -> String:
    "Get the current date and time"
    return shell("date")

flow main():
    write(stdout, "Agent with tools. Try: What's the weather in Amsterdam?")
    loop:
        input = read()
        if input == "quit":
            break
        response = think(input, tools=["get_weather", "get_time"])
        loop max=3:
            if not response.has_tool_calls:
                break
            response = exec(response, tools=["get_weather", "get_time"])
            response = think(response.content, tools=["get_weather", "get_time"])
        write(stdout, response.content)
